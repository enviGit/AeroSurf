<Window x:Class="AeroSurf.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:cef="clr-namespace:CefSharp.Wpf;assembly=CefSharp.Wpf"
        xmlns:local="clr-namespace:AeroSurf"
        Title="{Binding Title}" Height="720" Width="1080"
        WindowStyle="None" ResizeMode="CanResize" WindowState="Maximized"
        Background="#1E1E1E" BorderBrush="#333333" BorderThickness="1"
        Icon="/icon.ico">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="40" ResizeBorderThickness="5" GlassFrameThickness="0" CornerRadius="0"/>
    </WindowChrome.WindowChrome>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="40"/>
            <RowDefinition Height="50"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Background="#252526" MouseLeftButtonDown="TitleBar_MouseDown">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button x:Name="MenuBtn" Grid.Column="0" Click="MenuBtn_Click" Width="45" Height="40" Background="Transparent" BorderThickness="0" WindowChrome.IsHitTestVisibleInChrome="True" ToolTip="Menu">
                <Viewbox Width="18" Height="18">
                    <Path Data="{StaticResource LogoGeo}" Fill="#007ACC"/>
                </Viewbox>

                <Button.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Bookmarks" IsEnabled="False"/>
                        <MenuItem Header="History" IsEnabled="False"/>
                        <MenuItem Header="Downloads" IsEnabled="False"/>
                        <MenuItem Header="Settings" IsEnabled="False"/>
                        <Separator/>
                        <MenuItem Header="Close" Click="Close_Click"/>
                    </ContextMenu>
                </Button.ContextMenu>
            </Button>

            <StackPanel Grid.Column="2" Orientation="Horizontal">
                <Button Style="{StaticResource WindowControlBtn}" Click="Minimize_Click" Content="_"/>
                <Button Style="{StaticResource WindowControlBtn}" Click="Maximize_Click" Content="☐"/>
                <Button Style="{StaticResource CloseBtn}" Click="Close_Click" Content="✕"/>
            </StackPanel>
        </Grid>

        <Border Grid.Row="1" Background="#2D2D30" BorderBrush="#3E3E42" BorderThickness="0,0,0,1">
            <Grid Margin="5">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0" Command="{Binding GoBackCommand}" CommandParameter="{Binding ElementName=Browser}" Style="{StaticResource ModernBtn}" Focusable="False" ToolTip="Back">
                    <Path Data="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}" Stretch="Uniform" Height="16" Width="16"/>
                </Button>
                <Button Grid.Column="1" Command="{Binding GoForwardCommand}" CommandParameter="{Binding ElementName=Browser}" Style="{StaticResource ModernBtn}" Focusable="False" ToolTip="Forward">
                    <Path Data="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}" Stretch="Uniform" Height="16" Width="16"/>
                </Button>
                <Button Grid.Column="2" Command="{Binding ReloadCommand}" CommandParameter="{Binding ElementName=Browser}" Style="{StaticResource ModernBtn}" Focusable="False" ToolTip="Refresh">
                    <Path Data="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}" Stretch="Uniform" Height="16" Width="16"/>
                </Button>

                <Border Grid.Column="3" Background="#1E1E1E" CornerRadius="15" Margin="10,2" BorderBrush="#3E3E3E" BorderThickness="1">
                    <TextBox x:Name="UrlTextBox" Text="{Binding Address, UpdateSourceTrigger=PropertyChanged}" Background="Transparent" Foreground="White" BorderThickness="0" VerticalContentAlignment="Center" Padding="10,0" FontSize="14" CaretBrush="White" PreviewMouseLeftButtonDown="UrlTextBox_PreviewMouseLeftButtonDown" GotKeyboardFocus="UrlTextBox_GotKeyboardFocus">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Enter" Command="{Binding SearchCommand}" CommandParameter="{Binding ElementName=Browser}"/>
                        </TextBox.InputBindings>
                    </TextBox>
                </Border>
                <Button Grid.Column="4" Content="GO" Command="{Binding SearchCommand}" CommandParameter="{Binding ElementName=Browser}" Style="{StaticResource ModernBtn}" Width="50" Margin="5,0,0,0" FontWeight="Bold"/>
            </Grid>
        </Border>

        <ItemsControl Grid.Row="2" ItemsSource="{Binding Tabs}">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <Grid />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <cef:ChromiumWebBrowser Address="{Binding Url, Mode=OneWay}" Loaded="Browser_Loaded" Title="{Binding Title, Mode=OneWayToSource}" AddressChanged="Browser_AddressChanged" TitleChanged="Browser_TitleChanged"/>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
            <ItemsControl.ItemContainerStyle>
                <Style TargetType="ContentPresenter">
                    <Setter Property="Visibility" Value="Collapsed"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsSelected}" Value="True">
                            <Setter Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </ItemsControl.ItemContainerStyle>
        </ItemsControl>

        <Grid Grid.Row="1" Grid.RowSpan="2" Panel.ZIndex="99" HorizontalAlignment="Left" Width="280">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="15"/>
            </Grid.ColumnDefinitions>
            <Grid.Triggers>
                <EventTrigger RoutedEvent="MouseEnter">
                    <BeginStoryboard>
                        <Storyboard>
                            <DoubleAnimation Storyboard.TargetName="SidebarPanel" Storyboard.TargetProperty="Width" To="250" Duration="0:0:0.2" DecelerationRatio="0.5"/>
                        </Storyboard>
                    </BeginStoryboard>
                </EventTrigger>
                <EventTrigger RoutedEvent="MouseLeave">
                    <BeginStoryboard>
                        <Storyboard>
                            <DoubleAnimation Storyboard.TargetName="SidebarPanel" Storyboard.TargetProperty="Width" To="0" Duration="0:0:0.25" AccelerationRatio="0.5"/>
                        </Storyboard>
                    </BeginStoryboard>
                </EventTrigger>
            </Grid.Triggers>

            <Border x:Name="SidebarPanel" Grid.Column="0" Width="0" Background="#252526" BorderBrush="#3E3E42" BorderThickness="0,0,1,0" ClipToBounds="True">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Button Command="{Binding AddTabCommand}" Margin="10" Height="35" Background="#007ACC" BorderThickness="0" Content="+ NEW TAB" Foreground="White" FontWeight="Bold" Cursor="Hand">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}" CornerRadius="4">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#0063A5"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>

                    <ListBox Grid.Row="1" ItemsSource="{Binding Tabs}" SelectedItem="{Binding SelectedTab}" ItemContainerStyle="{StaticResource TabItemContainerStyle}" Background="Transparent" BorderThickness="0" Margin="5,0,5,10" ScrollViewer.HorizontalScrollBarVisibility="Disabled"/>

                    <Border Grid.Row="2" Background="#2D2D30" BorderBrush="#3E3E42" BorderThickness="0,1,0,0" ClipToBounds="True">
                        <Border.Style>
                            <Style TargetType="Border">
                                <Setter Property="Height" Value="0"/>
                                <Setter Property="Opacity" Value="0"/>
                                <Setter Property="Padding" Value="0"/>
                                <Setter Property="Margin" Value="0"/>

                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding HasMedia}" Value="True">
                                        <DataTrigger.EnterActions>
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <DoubleAnimation Storyboard.TargetProperty="Height" To="110" Duration="0:0:0.3" DecelerationRatio="0.5"/>
                                                    <DoubleAnimation Storyboard.TargetProperty="Opacity" To="1.0" Duration="0:0:0.3"/>
                                                    <ThicknessAnimation Storyboard.TargetProperty="Margin" To="0,0,0,40" Duration="0:0:0.3" DecelerationRatio="0.5"/>
                                                    <ThicknessAnimation Storyboard.TargetProperty="Padding" To="10" Duration="0:0:0.3"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </DataTrigger.EnterActions>

                                        <DataTrigger.ExitActions>
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <DoubleAnimation Storyboard.TargetProperty="Height" To="0" Duration="0:0:0.2" AccelerationRatio="0.5"/>
                                                    <DoubleAnimation Storyboard.TargetProperty="Opacity" To="0" Duration="0:0:0.2"/>
                                                    <ThicknessAnimation Storyboard.TargetProperty="Margin" To="0" Duration="0:0:0.2"/>
                                                    <ThicknessAnimation Storyboard.TargetProperty="Padding" To="0" Duration="0:0:0.2"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </DataTrigger.ExitActions>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>

                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Grid Grid.Row="0" Margin="0,0,0,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Border Background="#3E3E42" CornerRadius="4" Width="32" Height="32" Margin="0,0,10,0">
                                    <Viewbox Width="16" Height="16">
                                        <Path Data="{StaticResource IconMusic}" Fill="#888"/>
                                    </Viewbox>
                                </Border>
                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock Text="Now Playing" FontSize="10" Foreground="#888" FontWeight="Bold"/>
                                    <TextBlock Text="{Binding MediaTab.Title}" FontSize="12" Foreground="#EEE" TextTrimming="CharacterEllipsis"/>
                                </StackPanel>
                            </Grid>

                            <Grid Grid.Row="1" HorizontalAlignment="Center">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Button Grid.Column="0" Command="{Binding GlobalPrevCommand}" Style="{StaticResource ModernBtn}" ToolTip="Previous / -10s">
                                    <Viewbox Width="14" Height="14">
                                        <Path Data="{StaticResource IconPrev}" Fill="#DDD"/>
                                    </Viewbox>
                                </Button>

                                <Button Grid.Column="1" Command="{Binding GlobalPlayPauseCommand}" Margin="10,0" Width="40" Height="40" Background="#007ACC" BorderThickness="0" Style="{StaticResource ModernBtn}">
                                    <Button.Resources>
                                        <Style TargetType="Button" BasedOn="{StaticResource ModernBtn}">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="{TemplateBinding Background}" CornerRadius="20">
                                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#0063A5"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Resources>
                                    <Viewbox Width="16" Height="16">
                                        <Path Data="{StaticResource IconPlay}" Fill="White"/>
                                    </Viewbox>
                                </Button>

                                <Button Grid.Column="2" Command="{Binding GlobalNextCommand}" Style="{StaticResource ModernBtn}" ToolTip="Next / +10s">
                                    <Viewbox Width="14" Height="14">
                                        <Path Data="{StaticResource IconNext}" Fill="#DDD"/>
                                    </Viewbox>
                                </Button>
                            </Grid>
                        </Grid>
                    </Border>
                </Grid>
            </Border>

            <Border Grid.Column="1" Background="Transparent"/>
        </Grid>
    </Grid>
</Window>